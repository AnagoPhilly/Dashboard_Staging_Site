<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>CleanDash</title>

    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="scheduler.css" />
    <link rel="stylesheet" href="payroll.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
           emailjs.init("dIbzeCVC1Eg37asrY");
        })();
    </script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-HBLVYZSS3M"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-HBLVYZSS3M');
    </script>
    <style>
        .vh {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border: 0;
        }
    </style>
</head>
<body>

<div id="userEmail" style="display:none;"></div>
<div id="appLoading"><div>Loading CleanDash...</div><div></div></div>

<div id="loginPage" class="login-container">
    <div class="login-box">
        <h1>CleanDash</h1>
        <label for="email" class="vh">Email</label>
        <input type="email" id="email" placeholder="Email" />
        <label for="password" class="vh">Password</label>
        <input type="password" id="password" placeholder="Password" />
        <button onclick="login()">Login</button>

        <p style="margin-top: 1.5rem; font-size: 0.85rem; color: #6b7280; line-height: 1.4;">
            Franchise Owner? <br>
            Contact the <strong style="color: var(--primary);">Home Office</strong> to activate your account.
        </p>
    </div>
</div>

<div id="app" class="app-container" style="display:none;">

    <div class="sidebar">
        <div class="sidebar-header">
            <h1>CleanDash</h1>
            <div id="userNameDisplay" style="font-weight: 600;">Loading...</div>
            <div id="userEmailDisplay" style="font-size:0.85rem; opacity:0.7;"></div>
        </div>
        <nav class="nav">
            <div class="nav-item active" data-page="dashboard">Dashboard</div>
            <div class="nav-item" data-page="accounts">Accounts</div>
            <div class="nav-item" data-page="employees">Team Management</div>
            <div class="nav-item" data-page="scheduler">Scheduler</div>
            <div class="nav-item" data-page="payroll">Payroll Tracking</div>
            <div class="nav-item" data-page="metrics">Metrics Graph</div>
            <div class="nav-item" data-page="pnl">P&L Statement</div>
            <div class="nav-item" data-page="cfee_calc">CFee Calculator</div>
            <div class="nav-item" data-page="ad_generator">Ad Generator</div>
            <div class="nav-item" data-page="profile">Profile</div>

            <div class="nav-item" style="margin-top: 20px; border-top: 1px solid #374151; color: #9ca3af;" onclick="window.open('import.html', '_blank')">
                Import Data
            </div>

            <div class="nav-item logout" onclick="logout()">Logout</div>
        </nav>
    </div>

    <div class="main-content">

        <div id="dashboard" class="page active">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header" style="border-bottom:none; margin-bottom:0; padding-bottom:0;">
                        <h2>Account Map</h2>
                        <p>Geographic overview of all active service locations.</p>
                    </div>

                    <div id="dashboardKPIs" class="kpi-scorecard-dashboard">
                        <p style="text-align:center; color:#888;">Loading KPIs...</p>
                    </div>

                    <div class="dashboard-split-container">
                        <div id="map" class="dashboard-map"></div>
                        <div class="dashboard-list-panel">
                            <h3 style="margin:0 0 1rem 0; font-size:1.1rem; color:#1f2937; border-bottom:1px solid #e5e7eb; padding-bottom:10px;">Active Accounts</h3>
                            <div id="dashAccountList" class="dash-list-scroll">
                                <div style="color:#9ca3af; text-align:center; padding:2rem;">Loading accounts...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="accounts" class="page">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header">
                        <div>
                            <h2>My Accounts</h2>
                            <p>Manage your client list, revenue, and building specifications.</p>
                        </div>
                        <div style="display:flex; gap:10px;">
                            <button onclick="window.open('import.html', '_blank')" class="btn btn-secondary" style="border:1px solid #d1d5db;">üìÇ Import List</button>
                            <button onclick="showAddAccount()" class="btn btn-primary">+ Add Account</button>
                        </div>
                    </div>

                    <h3 style="color:#0d9488; border-bottom:2px solid #f0fdfa; padding-bottom:10px; margin-bottom:15px;">Active Accounts</h3>
                    <div id="accountsList">
                        <p style="color:#888; text-align:center;">Loading accounts...</p>
                    </div>

                    <h3 style="color:#6b7280; border-bottom:2px solid #f3f4f6; padding-bottom:10px; margin-top:40px; margin-bottom:15px;">Inactive / Canceled</h3>
                    <div id="inactiveAccountsList">
                        <p style="color:#9ca3af; text-align:center; font-size:0.9rem;">No inactive accounts.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="employees" class="page">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header">
                        <div>
                            <h2>Team Management</h2>
                            <p>Manage your roster, pay rates, and contact info.</p>
                        </div>
                        <button onclick="showAddEmployee()" class="btn btn-primary">+ Add Member</button>
                    </div>
                    <h3 style="color:#0d9488; border-bottom:2px solid #f0fdfa; padding-bottom:10px; margin-bottom:15px;">Active Team</h3>
                    <div id="employeeListActive">
                        <p style="color:#888; text-align:center;">Loading active team...</p>
                    </div>

                    <h3 style="color:#d97706; border-bottom:2px solid #fffbeb; padding-bottom:10px; margin-top:40px; margin-bottom:15px;">Waiting List / Applicants</h3>
                    <div id="employeeListWaiting">
                        <p style="color:#9ca3af; text-align:center; font-size:0.9rem;">No applicants on waiting list.</p>
                    </div>

                    <h3 style="color:#6b7280; border-bottom:2px solid #f3f4f6; padding-bottom:10px; margin-top:40px; margin-bottom:15px;">Inactive / Past Employees</h3>
                    <div id="employeeListInactive">
                        <p style="color:#9ca3af; text-align:center; font-size:0.9rem;">No inactive records.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="scheduler" class="page">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header">
                        <div>
                            <h2>Schedule</h2>
                            <p id="weekRangeDisplay">Loading dates...</p>
                        </div>

                        <div class="view-toggles">
                            <button class="btn-view-toggle" onclick="changeView('day')" data-view="day">Day</button>
                            <button class="btn-view-toggle active" onclick="changeView('week')" data-view="week">Week</button>
                            <button class="btn-view-toggle" onclick="changeView('month')" data-view="month">Month</button>
                        </div>

                        <div style="display:flex; gap:10px; align-items:center;">
                            <button onclick="openShiftModal(new Date())" class="btn btn-primary" style="flex-shrink: 0;">+ Add Shift</button>
                            <button class="btn btn-secondary" onclick="changePeriod(-1)">‚Üê Prev</button>
                            <button class="btn btn-secondary" onclick="changePeriod(1)">Next ‚Üí</button>
                        </div>
                    </div>

                    <div id="alertControls" class="alert-info-block" style="margin-bottom: 1.5rem; padding: 1rem; border-radius: 8px; display: none; align-items: center; justify-content: space-between;">
                        <span class="alert-info-label">Email Alert Settings:</span>

                        <div style="display: flex; gap: 15px; align-items:center;">
                            <label class="toggle-label alert-info-text" for="editEmailEnabled" style="flex-shrink:0; cursor: pointer;">
                                <input type="checkbox" id="editEmailEnabled" style="width:auto; margin-right:8px;" onchange="saveScheduleSettings()"> Enable Alerts
                            </label>

                            <div style="flex:1; display: flex; align-items: center; gap: 5px;">
                                <span class="alert-info-text" style="font-size: 0.9rem; font-weight: 600;">Delay:</span>
                                <input type="number" id="editEmailDelay" placeholder="60" value="60"
                                       class="alert-info-input"
                                       style="width: 60px; padding: 5px; border-radius: 4px;"
                                       onchange="saveScheduleSettings()" oninput="this.value = this.value.replace(/[^0-9]/g, '');"/>
                                <small class="alert-info-text" style="font-size:0.75rem;">minutes</small>
                            </div>
                        </div>
                    </div>
                    <div id="schedulerGrid" class="scheduler-container"></div>
                </div>
            </div>
        </div>

        <div id="payroll" class="page">
            <div class="page-container">
                <div class="content-card" style="background: #f0fdfa; border: 1px solid #ccfbf1; margin-bottom: 1.5rem;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <h2 style="color:#0d9488; margin-bottom:0.5rem;">Total Payroll</h2>
                            <p style="margin:0; color:#4b5563;">Based on completed shifts in selected range.</p>
                        </div>
                        <div style="text-align:right;">
                            <h1 id="totalPayrollCost" style="font-size:2.5rem; color:#0f766e; margin:0;">$0.00</h1>
                        </div>
                    </div>
                </div>

                <div class="content-card">
                    <div class="card-header">
                        <div>
                            <h2>Payroll Period</h2>
                            <p>Select dates to calculate hours.</p>
                        </div>
                        <div style="display:flex; gap:10px; align-items:center;">
                            <label for="payStart" class="vh">Start Date</label>
                            <input type="date" id="payStart" class="form-control" style="padding:8px; border-radius:6px; border:1px solid #ddd;" onchange="updatePayrollDates()">

                            <span style="color:#666;">to</span>

                            <label for="payEnd" class="vh">End Date</label>
                            <input type="date" id="payEnd" class="form-control" style="padding:8px; border-radius:6px; border:1px solid #ddd;" onchange="updatePayrollDates()">

                            <button class="btn btn-secondary" onclick="exportPayrollCSV()">Export CSV</button>
                        </div>
                    </div>

                    <div id="payrollTableContainer"></div>
                </div>
            </div>
        </div>

        <div id="metrics" class="page">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header">
                        <div>
                            <h2>Performance Metrics</h2>
                            <p>Analyze revenue trends over time.</p>
                        </div>
                        <div>
                            <button class="btn btn-secondary" onclick="toggleMetricsInput()">Show/Hide Data</button>
                            <button class="btn btn-secondary" onclick="clearMetrics()">Clear</button>
                        </div>
                    </div>

                    <div id="metricsLayout" class="metrics-layout">
                        <div id="metricsInputPanel" class="metrics-input-section">
                            <span class="metrics-label">Data Source:</span>
                            <button class="btn btn-primary" style="width:100%; margin-bottom:1rem; background:#3b82f6;" onclick="generateMetricsGraphFromDB()">
                                üìä Load Graph from My Accounts
                            </button>

                            <div style="text-align:center; margin-bottom:1rem; font-weight:bold; color:#ccc;">‚Äî OR ‚Äî</div>

                            <span class="metrics-label">Paste Manual Data:</span>
                            <p style="font-size:0.8rem; color:#666; margin-bottom:0.5rem;">Copy the table directly from your Excel sheet or Database (Date, Amount, etc.) and paste below.</p>
                            <textarea id="metricsInput" class="metrics-textarea" placeholder="Paste rows here (e.g. 11/20/25  $7,492.63)..."></textarea>
                            <button class="btn btn-primary" style="width:100%; margin-top:1rem;" onclick="generateMetricsGraph()">Generate Graph</button>
                        </div>

                        <div class="metrics-right-panel">
                            <div id="metricsStats" class="metrics-stats-row" style="display:none;">
                                <div class="stat-card">
                                    <span class="stat-label">Total Revenue</span>
                                    <span class="stat-value" id="statTotal">$0</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-label">Highest Month</span>
                                    <span class="stat-value" id="statHigh">$0</span>
                                </div>
                                <div class="stat-card">
                                    <span class="stat-label">Average Monthly</span>
                                    <span class="stat-value" id="statAvg">$0</span>
                                </div>
                            </div>

                            <div class="metrics-chart-wrapper">
                                <div id="chartFilters" class="chart-filters" style="display:none;">
                                    <button class="filter-btn active" onclick="filterChart('ALL')">All Time</button>
                                    <button class="filter-btn" onclick="filterChart('12M')">Last 12 Months</button>
                                    <button class="filter-btn" onclick="filterChart('YTD')">YTD</button>
                                </div>
                                <div style="position: relative; height: 400px; width: 100%;">
                                    <canvas id="performanceChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="pnl" class="page">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header">
                        <div>
                            <h2>Profit & Loss</h2>
                            <p>Financial statement and forecasting.</p>
                        </div>
                        <div class="no-print">
                            <button class="btn btn-secondary" onclick="window.print()">Print</button>
                            <button class="btn btn-secondary" onclick="downloadPDF()">Download PDF</button>
                        </div>
                    </div>

                    <div id="financialScorecard" style="margin-bottom: 2rem;"></div>
                    <div id="revenueChartContainer" class="chart-container" style="display:none; margin-bottom: 2rem;">
                        <div id="revenueChart" class="revenue-chart"></div>
                        <div id="chartLegend" class="chart-legend"></div>
                    </div>
                    <div id="accountsContainer"></div>
                    <div id="grandTotal" class="grand-total" style="display:none;">
                        <h3>Grand Total</h3>
                        <div class="grand-row"><span>Total Revenue</span><span id="totalAllRevenue">$0</span></div>
                        <div class="grand-row"><span>Labor Costs</span><span id="totalAllLabor">$0</span></div>
                        <div class="grand-row"><span>Supplies</span><span id="totalAllSupplies">$0</span></div>
                        <div class="grand-row"><span>Overhead Expenses</span><span id="totalAllOverhead">$0</span></div>
                        <div class="grand-row"><span>Cfees (Included)</span><span id="totalAllCfees">$0</span></div>
                        <div class="grand-row"><span>Cost of Doing Business</span><span id="totalAllCodb">$0</span></div>
                        <div class="grand-row" style="border-top:1px solid #eee; margin-top:0.5rem; padding-top:0.5rem;"><strong>Total Expenses</strong><span id="totalAllExpenses" style="font-weight:bold;">$0</span></div>
                        <div class="grand-row grand-profit"><span id="grandNetMonthlyLabel">Net Profit Monthly</span><span id="totalNetMonthly">$0</span></div>
                        <div class="grand-row grand-profit" style="font-size:1.1rem !important; color:#4b5563 !important;"><span id="grandNetAnnualLabel">Net Profit Annual</span><span id="totalNetAnnual">$0</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="cfee_calc" class="page">
            <div class="page-container">
                <div class="content-card" id="calcPrintArea">
                    <div class="card-header">
                        <div>
                            <h2>C-Fee Calculator</h2>
                            <p>Estimate quote and financing options.</p>
                        </div>
                        <div data-html2canvas-ignore="true">
                            <button class="btn btn-secondary" onclick="window.print()">Print</button>
                            <button class="btn btn-primary" onclick="downloadCalcPDF()">Download PDF</button>
                        </div>
                    </div>

                    <div class="calc-inputs-grid">
                        <div class="input-wrapper">
                            <label for="calc_name">Account Name</label>
                            <input type="text" id="calc_name" placeholder="Client Name" />
                        </div>
                        <div class="input-wrapper">
                            <label for="calc_revenue">Monthly Revenue ($)</label>
                            <input type="number" id="calc_revenue" placeholder="10000" oninput="runCfeeCalc()" />
                        </div>
                        <div class="input-wrapper">
                            <label for="calc_cfi">CFI Factor</label>
                            <input type="number" id="calc_cfi" step="0.01" placeholder="3.0" oninput="runCfeeCalc()" />
                        </div>
                    </div>
                </div>

                <div id="calcResults" class="calc-cards-grid">
                    <div class="result-card green">
                        <h3>Cash Payment</h3>
                        <div class="card-amount" id="val_cash_total">$0.00</div>
                        <div class="card-subtext">Total Due Today</div>
                        <div class="card-details">
                            <div class="detail-row">
                                <span id="lbl_cash_cfee">C-fee Amount</span>
                                <span id="val_cash_cfee_detail">$0.00</span>
                            </div>
                            <div class="detail-row" style="color:#10b981;">
                                <span>Cash Discount (15%)</span>
                                <span id="val_cash_disc">($0.00)</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card blue">
                        <h3>120 Days No Interest</h3>
                        <div class="card-amount" id="val_120_pay">$0.00</div>
                        <div class="card-subtext">Monthly Payment (4 months)</div>
                        <div class="card-details">
                            <div class="detail-row">
                                <span id="lbl_120_cfee">C-fee Amount</span>
                                <span id="val_120_cfee">$0.00</span>
                            </div>
                            <div class="detail-row total">
                                <span>Total C-fee Due</span>
                                <span id="val_120_total_cfee">$0.00</span>
                            </div>
                        </div>
                    </div>

                    <div class="result-card purple">
                        <div class="card-badge">Most Common</div>
                        <h3>Financed (12 Months)</h3>
                        <div class="card-amount" id="val_fin_pay">$0.00</div>
                        <div class="card-subtext">Monthly Payment (12 months)</div>
                        <div class="card-details">
                            <div class="detail-row">
                                <span id="lbl_fin_cfee">C-fee Amount</span>
                                <span id="val_fin_cfee">$0.00</span>
                            </div>
                            <div class="detail-row">
                                <span>12% Interest</span>
                                <span id="val_fin_int">$0.00</span>
                            </div>
                            <div class="detail-row total">
                                <span>Financed Total</span>
                                <span id="val_fin_total">$0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="ad_generator" class="page">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header">
                        <div>
                            <h2>Employee Ad Generator</h2>
                            <p>Generate high-converting job posts in seconds.</p>
                        </div>
                        <button onclick="resetAdForm()">Reset</button>
                    </div>

                    <div class="ad-layout-stack">
                        <div class="marketing-controls" style="background:#f3f4f6; border:1px solid #d1d5db; color:#374151;">
                            <div style="flex:1; display:flex; align-items:center; gap:10px;">
                                <label for="ad_role_preset">Job Role:</label>
                                <select id="ad_role_preset" onchange="applyJobPreset()">
                                    <option value="general">General Cleaner (Standard)</option>
                                    <option value="floor">Floor Technician (Strip & Wax)</option>
                                    <option value="day">Day Porter (Business Hours)</option>
                                    <option value="lead">Team Lead / Supervisor</option>
                                </select>
                            </div>
                            <label class="toggle-label" for="ad_urgent"><input type="checkbox" id="ad_urgent"> Mark as "Urgent Hiring"</label>
                            <label class="toggle-label" for="ad_spanish_pref"><input type="checkbox" id="ad_spanish_pref"> Bilingual Preferred</label>
                        </div>

                        <div class="ad-form-grid">
                            <div class="ad-section-title">The Logistics</div>
                            <div class="ad-input-group"><label for="ad_loc">Location (City/Neighborhood):</label><input type="text" id="ad_loc" placeholder="e.g. Downtown Austin" /></div>
                            <div class="ad-input-group"><label for="ad_pay">Pay Rate:</label><input type="text" id="ad_pay" placeholder="e.g. $18.00/hr (Weekly Pay)" /></div>
                            <div class="ad-input-group">
                                <span class="form-label">Schedule:</span>
                                <div class="day-selector" id="daySelector"><button class="day-btn" onclick="toggleDay(this)">Mon</button><button class="day-btn" onclick="toggleDay(this)">Tue</button><button class="day-btn" onclick="toggleDay(this)">Wed</button><button class="day-btn" onclick="toggleDay(this)">Thu</button><button class="day-btn" onclick="toggleDay(this)">Fri</button><button class="day-btn" onclick="toggleDay(this)">Sat</button><button class="day-btn" onclick="toggleDay(this)">Sun</button></div>
                            </div>
                            <div class="ad-input-group"><label for="ad_hours">Shift Hours:</label><input type="text" id="ad_hours" placeholder="e.g. 6:00 PM - 10:00 PM" /></div>
                            <div class="ad-section-title">Why work here?</div>
                            <div class="ad-input-group" style="grid-column: 1 / -1;">
                                <span class="form-label">Quick Perks (Click to Add):</span>
                                <div class="chip-container" id="perksContainer"><div class="chip" onclick="toggleChip(this)">Weekly Pay</div><div class="chip" onclick="toggleChip(this)">Direct Deposit</div><div class="chip" onclick="toggleChip(this)">Paid Training</div><div class="chip" onclick="toggleChip(this)">Uniforms Provided</div><div class="chip" onclick="toggleChip(this)">No Weekends</div><div class="chip" onclick="toggleChip(this)">Stay Active</div><div class="chip" onclick="toggleChip(this)">Work Alone / Independent</div><div class="chip" onclick="toggleChip(this)">Opportunities for Growth</div></div>
                            </div>
                            <div class="ad-input-group" style="grid-column: 1 / -1;"><label for="ad_offer_custom">Additional Offer Details:</label><textarea id="ad_offer_custom" placeholder="Any specific benefits not listed above..." style="min-height:60px;"></textarea></div>
                            <div class="ad-section-title">Requirements & Contact</div>
                            <div class="ad-input-group">
                                <span class="form-label">Must Haves (Click to Add):</span>
                                <div class="chip-container" id="reqsContainer"><div class="chip" onclick="toggleChip(this)">Reliable Vehicle</div><div class="chip" onclick="toggleChip(this)">Smartphone</div><div class="chip" onclick="toggleChip(this)">Clean Background</div><div class="chip" onclick="toggleChip(this)">Lift 25+ lbs</div><div class="chip" onclick="toggleChip(this)">Authorized to Work in US</div></div><small style="color:#666; margin-top:5px;">* "18+ Years Old" is automatically included.</small>
                            </div>
                            <div class="ad-input-group">
                                <label for="ad_contact_method">How to Apply:</label>
                                <div style="display:flex; gap:10px;">
                                    <select id="ad_contact_method" style="flex:1;"><option value="text_call">Text or Call</option><option value="text_only">Text Only (Start with Text)</option><option value="email">Email Resume</option><option value="link">Apply at Link</option></select>
                                    <label for="ad_contact" class="vh">Contact Detail</label>
                                    <input type="text" id="ad_contact" placeholder="(555) 123-4567" style="flex:2;" />
                                </div>
                            </div>
                        </div>

                        <div class="ad-actions-row">
                            <button class="btn-ad-action" style="background:var(--primary);" onclick="generateAd()">Generate Ad</button>
                            <button class="btn-ad-action" onclick="copyAdToClipboard()">Copy Text</button>
                            <button class="btn-ad-action" onclick="printAd()">Print Flyer</button>
                            <button class="btn-ad-action" onclick="downloadAdPdf()">Download PDF</button>
                            <button class="btn-ad-action" id="btn_translate" onclick="toggleTranslation()">Translate to Spanish</button>
                        </div>

                        <label for="adOutput" class="vh">Ad Output Text</label>
                        <textarea id="adOutput" class="ad-output-area" placeholder="Click 'Generate Ad' to build your job post..."></textarea>
                        <div id="hidden-flyer"></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="profile" class="page">
            <div class="page-container">
                <div class="content-card">
                    <div class="card-header">
                        <h2>My Profile</h2>
                        <p>Update your personal information and default settings.</p>
                    </div>
                    <div id="profileView" class="profile-view"><div><p>Full Name</p><h3 id="viewName">Loading...</h3></div><div><p>Email</p><h3 id="viewEmail">Loading...</h3></div><div style="grid-column:span 2;"><p>Home Address</p><h3 id="viewAddress">Not set</h3></div><div><p>CFI Factor</p><h3 id="viewCfi">0.00</h3></div><div><p>Cost of Doing Business (%)</p><h3 id="viewCodb">25%</h3></div></div>
                    <div id="profileEdit" style="display:none;">
                        <form class="profile-form" style="display:grid; grid-template-columns:1fr 1fr; gap:2rem;">
                            <div class="input-wrapper">
                                <label for="editName">Full Name</label>
                                <input type="text" id="editName" />
                            </div>
                            <div class="input-wrapper">
                                <label for="editEmail">Email</label>
                                <input type="email" id="editEmail" disabled style="background:#f9fafb;" />
                            </div>

                            <div class="input-wrapper" style="grid-column: span 2; background: #f0fdfa; padding: 15px; border-radius: 8px; border: 1px solid #ccfbf1;">
                                <h4 style="margin-top: 0; margin-bottom: 10px; font-size: 0.95rem; color: #0f766e;">üì± Set Up Text Alerts (Free)</h4>

                                <div class="split-inputs-container" style="gap: 10px; margin-bottom: 0;">
                                    <div class="input-wrapper">
                                        <label for="editPhoneNumber">Phone Number (10 Digits)</label>
                                        <input type="text" id="editPhoneNumber" placeholder="e.g. 215-555-1234" oninput="this.value=this.value.replace(/[^0-9-]/g,''); generateSmsEmail();"/>
                                    </div>
                                    <div class="input-wrapper">
                                        <label for="editCarrier">Select Carrier</label>
                                        <select id="editCarrier" onchange="generateSmsEmail()">
                                            <option value="">-- Select Carrier --</option>
                                            <option value="vtext.com">Verizon / Xfinity Mobile</option>
                                            <option value="txt.att.net">AT&T</option>
                                            <option value="tmomail.net">T-Mobile</option>
                                            <option value="messaging.sprintpcs.com">Sprint</option>
                                            <option value="mms.cricketwireless.net">Cricket</option>
                                        </select>
                                    </div>
                                </div>
                                <small id="smsPreview" style="color: #1e40af; font-weight: 600; margin-top: 5px; display: block;">
                                    Final SMS Address: Not Set
                                </small>
                            </div>
                            <div class="input-wrapper" style="grid-column:span 2;">
                                <label for="editAddress">Home Address</label>
                                <input type="text" id="editAddress" />
                            </div>
                            <div class="input-wrapper">
                                <label for="editCfi">CFI Factor</label>
                                <input type="number" step="0.01" id="editCfi" />
                            </div>
                            <div class="input-wrapper">
                                <label for="editCodb">CoDB (%)</label>
                                <input type="number" step="0.1" id="editCodb" />
                            </div>

                            <div class="input-wrapper" style="grid-column:span 2;">
                                <label for="editAlertThreshold">Late Alert Threshold (minutes)</label>
                                <input type="number" id="editAlertThreshold" placeholder="15" />
                                <small style="color:#6b7280; font-size:0.75rem;">Shifts turn Red if not checked in by this time.</small>
                            </div>
                        </form>
                        <div style="margin-top:2rem; display:flex; gap:1rem;">
                            <button class="btn btn-primary" onclick="saveProfile()">Save Changes</button>
                            <button class="btn btn-secondary" onclick="cancelEdit()">Cancel</button>
                        </div>
                        <div id="saveSuccess" style="color:green; margin-top:1rem; display:none;">Saved!</div>
                    </div>

                    <div id="editBtnContainer" style="margin-top:2rem;"><button id="editProfileBtn" class="btn btn-secondary">Edit Profile</button></div>
                </div>
            </div>
        </div>

    </div>
</div>

<div id="addAccountModal" class="modal">
    <div class="modal-content">
        <h2>Add New Account</h2>

        <div style="display: flex; gap: 10px; align-items: flex-end; margin-bottom: 15px; padding: 15px; background: #f0fdfa; border: 1px dashed #0d9488; border-radius: 8px;">
            <div class="input-wrapper" style="flex: 1; margin-bottom: 0;">
                <label for="accountPID" style="color: #0f766e; font-weight: 700;">Account ID (PID)</label>
                <input type="text" id="accountPID" placeholder="Enter Account ID..." style="margin-bottom: 0; background: white;">
            </div>
            <button type="button" id="btnPidAutoFill" class="btn btn-primary" style="height: 45px; display: flex; align-items: center; gap: 5px; white-space: nowrap;">
                ‚ú® PID Auto Fill
            </button>
        </div>
        <div class="input-wrapper" style="margin-bottom:10px;">
            <label for="accountName">Account Name (Location)</label>
            <input type="text" id="accountName" placeholder="e.g. Downtown Office Park" />
        </div>
        <div class="input-wrapper" style="margin-bottom:10px;">
            <label for="accountAddress">Full Address</label>
            <input type="text" id="accountAddress" placeholder="123 Main St..." />
        </div>
        <div class="split-inputs-container">
            <div class="input-wrapper"><label for="accountRevenue">Monthly Revenue ($)</label><input type="number" id="accountRevenue" placeholder="0.00" /></div>
            <div class="input-wrapper"><label for="accountAlarm">Alarm Code</label><input type="text" id="accountAlarm" placeholder="e.g. 1234#" /></div>
        </div>
        <div class="split-inputs-container">
            <div class="input-wrapper"><label for="accountStartDate">Start Date</label><input type="date" id="accountStartDate" /></div>
            <div class="input-wrapper"><label for="accountEndDate">End Date (Optional)</label><input type="date" id="accountEndDate" /><small style="color:#666; font-size:0.7rem;">Leave blank if active</small></div>
        </div>
        <div style="border-top:1px dashed #e5e7eb; margin-top:10px; padding-top:10px;">
            <h4 style="margin:0 0 10px 0; color:#0d9488; font-size:0.9rem;">Client Contact Info</h4>
            <div class="input-wrapper" style="margin-bottom:10px;"><label for="contactName">Contact Name</label><input type="text" id="contactName" placeholder="e.g. Jane Smith" /></div>
            <div class="split-inputs-container">
                <div class="input-wrapper"><label for="contactPhone">Phone</label><input type="text" id="contactPhone" placeholder="(555) 123-4567" /></div>
                <div class="input-wrapper"><label for="contactEmail">Email</label><input type="email" id="contactEmail" placeholder="jane@client.com" /></div>
            </div>
        </div>
        <div class="modal-buttons">
            <button onclick="saveNewAccount()">Add Account</button>
            <button onclick="hideAddAccount()" class="cancel">Cancel</button>
        </div>
    </div>
</div>

<div id="editAccountModal" class="modal">
    <div class="modal-content">
        <h2>Edit Account</h2>
        <input type="hidden" id="editAccountId" />
        <div class="input-wrapper" style="margin-bottom:10px;"><label for="editAccountName">Account Name</label><input type="text" id="editAccountName" /></div>
        <div class="input-wrapper" style="margin-bottom:10px;"><label for="editAccountAddress">Full Address</label><input type="text" id="editAccountAddress" /></div>
        <div class="split-inputs-container">
            <div class="input-wrapper"><label for="editAccountRevenue">Monthly Revenue ($)</label><input type="number" id="editAccountRevenue" /></div>
            <div class="input-wrapper"><label for="editAccountAlarm">Alarm Code</label><input type="text" id="editAccountAlarm" /></div>
        </div>
        <div class="split-inputs-container">
            <div class="input-wrapper"><label for="editAccountStartDate">Start Date</label><input type="date" id="editAccountStartDate" /></div>
            <div class="input-wrapper"><label for="editAccountEndDate">End Date</label><input type="date" id="editAccountEndDate" /><small style="color:#666; font-size:0.7rem;">Set date to mark Inactive</small></div>
        </div>
        <div style="border-top:1px dashed #e5e7eb; margin-top:10px; padding-top:10px;">
            <h4 style="margin:0 0 10px 0; color:#0d9488; font-size:0.9rem;">Client Contact Info</h4>
            <div class="input-wrapper" style="margin-bottom:10px;"><label for="editContactName">Contact Name</label><input type="text" id="editContactName" /></div>
            <div class="split-inputs-container">
                <div class="input-wrapper"><label for="editContactPhone">Phone</label><input type="text" id="editContactPhone" /></div>
                <div class="input-wrapper"><label for="editContactEmail">Email</label><input type="email" id="editContactEmail" /></div>
            </div>
        </div>
        <div class="modal-buttons">
            <button onclick="saveEditedAccount(event)">Save Changes</button>
            <button onclick="openCancelModal(document.getElementById('editAccountId').value)" class="btn btn-danger">Cancel Account</button>
            <button onclick="hideEditAccount()" class="cancel">Close</button>
        </div>
    </div>
</div>

<div id="employeeModal" class="modal">
    <div class="modal-content">
        <h2 id="empModalTitle">Add Team Member</h2>
        <input type="hidden" id="empId" />

        <div class="input-wrapper" style="margin-bottom:10px;">
            <label style="font-size:0.8rem; font-weight:700;" for="empName">Full Name</label>
            <input type="text" id="empName" placeholder="e.g. John Doe" />
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
            <div class="input-wrapper">
                <label style="font-size:0.8rem; font-weight:700;" for="empRole">Role</label>
                <select id="empRole" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px;">
                    <option value="General Cleaner">General Cleaner</option>
                    <option value="Floor Tech">Floor Tech</option>
                    <option value="Day Porter">Day Porter</option>
                    <option value="Lead/Supervisor">Lead/Supervisor</option>
                    <option value="Applicant">Applicant</option>
                </select>
            </div>
            <div class="input-wrapper">
                <label style="font-size:0.8rem; font-weight:700;" for="empWage">Hourly Wage ($)</label>
                <input type="number" id="empWage" placeholder="15.00" step="0.25" />
            </div>
        </div>

        <div class="input-wrapper" style="margin-bottom:10px;">
            <label for="empAddress">Home Address</label>
            <input type="text" id="empAddress" placeholder="123 Main St, City, State, Zip" />
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:10px;">
            <div class="input-wrapper">
                <label for="empEmail">Email (Login)</label>
                <input type="email" id="empEmail" placeholder="email@example.com" />
            </div>
            <div class="input-wrapper">
                <label for="empPhone">Phone</label>
                <input type="text" id="empPhone" placeholder="(555) 123-4567" />
            </div>
        </div>

        <div class="input-wrapper" style="margin-bottom:10px;">
            <label for="empPassword">Set Initial Password</label>
            <input type="text" id="empPassword" placeholder="e.g. Welcome2025!" />
            <small style="color:#6b7280; font-size:0.75rem;">Leave blank if just editing details. Minimum 6 chars.</small>
        </div>

        <div class="input-wrapper" style="margin-bottom:20px;">
            <label for="empStatus">Status</label>
            <select id="empStatus">
                <option value="Active">Active</option>
                <option value="Waiting">Waiting List</option>
                <option value="Inactive">Inactive (Keeps History)</option>
            </select>
        </div>

        <div id="resetPasswordContainer" style="margin-bottom:15px; display:none;">
            <button type="button" onclick="sendResetEmail()" class="btn btn-secondary">
                üìß Send Password Reset Email
            </button>
            <small style="color:#666; display:block; margin-top:5px; text-align:center; font-size:0.75rem;">
                Useful if the employee forgets their login.
            </small>
        </div>

        <div class="modal-buttons">
            <button onclick="saveEmployee()" class="btn btn-primary">Save Member</button>
            <button onclick="closeEmployeeModal()" class="cancel">Cancel</button>
        </div>
    </div>
</div>

<div id="shiftModal" class="modal">
    <div class="modal-content">
        <h2 id="shiftModalTitle">Assign Shift</h2>
        <input type="hidden" id="shiftId" />

        <div class="input-wrapper" style="margin-bottom:15px;">
            <label for="shiftAccount">Account (Location)</label>
            <select id="shiftAccount"></select>
        </div>

        <div class="input-wrapper" style="margin-bottom:15px;">
            <label for="shiftEmployee">Employee</label>
            <select id="shiftEmployee"></select>
        </div>

        <div class="input-wrapper" style="margin-bottom: 15px;">
            <label for="shiftStartDate">Shift Date</label>
            <input type="date" id="shiftStartDate" />
        </div>

        <div class="split-inputs-container">
            <div class="input-wrapper">
                <label for="shiftStartTime">Start Time</label>
                <select id="shiftStartTime"></select>
            </div>
            <div class="input-wrapper">
                <label for="shiftEndTime">End Time</label>
                <select id="shiftEndTime"></select>
            </div>
        </div>

        <div class="input-wrapper" style="margin-top: 15px;">
            <input type="checkbox" id="shiftRepeat" class="hidden-checkbox" onchange="toggleRecurrenceOptions()">
            <label for="shiftRepeat" class="btn-repeat-toggle">
                üîÑ Click here to repeat schedule
            </label>
        </div>

        <div id="recurrenceOptions" style="display:none; background:#f9fafb; padding:15px; border:1px solid #e5e7eb; border-radius:8px; margin-top:10px;">
            <div class="input-wrapper">
                <label style="margin-bottom:8px; display:block;">Select Days:</label>
                <div class="day-selector" style="display:flex; gap:8px; flex-wrap:wrap;">
                    <button type="button" class="day-btn-circle" data-day="1" onclick="toggleRecurrenceDay(this)">M</button>
                    <button type="button" class="day-btn-circle" data-day="2" onclick="toggleRecurrenceDay(this)">T</button>
                    <button type="button" class="day-btn-circle" data-day="3" onclick="toggleRecurrenceDay(this)">W</button>
                    <button type="button" class="day-btn-circle" data-day="4" onclick="toggleRecurrenceDay(this)">T</button>
                    <button type="button" class="day-btn-circle" data-day="5" onclick="toggleRecurrenceDay(this)">F</button>
                    <button type="button" class="day-btn-circle" data-day="6" onclick="toggleRecurrenceDay(this)">S</button>
                    <button type="button" class="day-btn-circle" data-day="0" onclick="toggleRecurrenceDay(this)">S</button>
                </div>
            </div>
            <div class="input-wrapper" style="margin-top:10px;">
                <label for="shiftRepeatEnd">Repeat Until Date:</label>
                <input type="date" id="shiftRepeatEnd" />
            </div>
        </div>

        <div id="manualTimeSection" style="background:#f9fafb; padding:15px; border-radius:8px; border:1px dashed #d1d5db; margin-top:20px; margin-bottom:20px; display:none;">
            <h4 style="margin-top:0; margin-bottom:10px; font-size:0.9rem; color:#b45309;">‚ö†Ô∏è Manual Time Override</h4>

            <div class="input-wrapper" style="margin-bottom: 10px;">
                <label for="actDate">Date Worked</label>
                <input type="date" id="actDate" />
            </div>

            <div class="split-inputs-container">
                <div class="input-wrapper">
                    <label for="actStartTime">Actual In</label>
                    <select id="actStartTime">
                        <option value="">-- Select --</option>
                    </select>
                </div>
                <div class="input-wrapper">
                    <label for="actEndTime">Actual Out</label>
                    <select id="actEndTime">
                        <option value="">-- Select --</option>
                    </select>
                </div>
            </div>

            <div class="input-wrapper" style="margin-top:10px;">
                <label for="shiftStatus">Status</label>
                <select id="shiftStatus">
                    <option value="Scheduled">Not Started</option>
                    <option value="Started">Started</option>
                    <option value="Completed">Completed</option>
                </select>
            </div>
        </div>

        <div class="modal-buttons" style="margin-top: 1.5rem;">
            <button onclick="saveShift()" class="btn btn-primary">Save Shift</button>
            <button onclick="deleteJobFromModal()" id="btnDeleteShift" class="btn btn-danger" style="display:none;">Delete</button>
            <button onclick="closeShiftModal()" class="cancel">Cancel</button>
        </div>
    </div>
</div>

<div id="specsModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <h2 id="specsModalTitle">Building Specifications</h2>
        <input type="hidden" id="currentSpecAccountId" />
        <div class="specs-container">
            <div>
                <h4 style="margin-bottom:0.5rem; color:#374151;">Current Documents</h4>
                <div id="specsList" class="specs-list-area"><div class="empty-specs">No specifications added yet.</div></div>
            </div>
            <div class="specs-upload-box" style="border-style: solid; background: #f9fafb;">
                <h4 style="margin-top:0; color:#0d9488;">Add Document Link</h4>
                <p style="font-size:0.85rem; color:#666; margin-bottom:1rem;">To save storage costs, upload your PDF to Google Drive or Dropbox, then paste the share link here.</p>
                <label for="newSpecName" class="vh">Document Name</label>
                <input type="text" id="newSpecName" placeholder="Document Name (e.g. Floorplan)" style="background:white;" />
                <label for="newSpecUrl" class="vh">Paste Link (https://...)</label>
                <input type="url" id="newSpecUrl" placeholder="Paste Link (https://...)" style="width:100%; padding:10px; border:1px solid #ddd; border-radius:6px; margin-bottom:10px;" />
                <button onclick="saveSpecLink()" style="width:100%; margin-top:0.5rem;">Save Document Link</button>
            </div>
        </div>
        <div class="modal-buttons" style="margin-top: 1.5rem;">
            <button onclick="closeSpecsModal()" class="cancel">Close</button>
        </div>
    </div>
</div>

<div id="cancelAccountModal" class="modal">
    <div class="modal-content" style="max-width: 450px;">
        <h2>Cancel Account</h2>
        <input type="hidden" id="cancelAccountId" />
        <p style="color:#666; margin-bottom:20px;">Please provide details for cancellation. This will move the account to the Inactive list.</p>

        <div class="input-wrapper" style="margin-bottom:15px;">
            <label style="font-weight:700;" for="cancelReason">Reason for Cancellation <span style="color:red">*</span></label>
            <select id="cancelReason" onchange="toggleOtherReason(this)">
                <option value="">-- Select Reason --</option>
                <option value="Performance">Performance Issue</option>
                <option value="InHouse">Taken In-House</option>
                <option value="Moved">Client Relocated/Moved</option>
                <option value="Transfer">Transfer to other Franchise</option>
                <option value="Price">Price / Budget</option>
                <option value="Other">Other</option>
            </select>
        </div>

        <div class="input-wrapper" id="otherReasonDiv" style="display:none; margin-bottom:15px;">
            <label>Specify Other Reason</label>
            <input type="text" id="cancelReasonOther" placeholder="Details..." />
        </div>

        <div class="input-wrapper" style="margin-bottom:20px;">
            <label style="font-weight:700;" for="cancelEndDate">End Date <span style="color:red">*</span></label>
            <input type="date" id="cancelEndDate" />
        </div>

        <div class="modal-buttons">
            <button onclick="confirmCancellation()" class="btn btn-danger">Confirm Cancellation</button>
            <button onclick="document.getElementById('cancelAccountModal').style.display='none'" class="cancel">Back</button>
        </div>
    </div>
</div>

<div id="inactiveReasonModal" class="modal">
    <div class="modal-content" style="max-width: 450px;">
        <h2 id="inactiveReasonTitle"></h2>
        <input type="hidden" id="inactiveAccountId" />
        <input type="hidden" id="actionType" />

        <label style="font-weight: 700; display: block; margin-bottom: 10px;">Reason for Inactivation:</label>

        <div id="reasonRadioButtons" class="radio-group" style="display:flex; flex-direction:column; gap:8px; margin-bottom:20px;">
            <label><input type="radio" name="inactiveReason" value="Performance" required> Client Performance Issue</label>
            <label><input type="radio" name="inactiveReason" value="InHouse"> Moved Cleaning In-House</label>
            <label><input type="radio" name="inactiveReason" value="Moved"> Client Relocated/Moved</label>
            <label><input type="radio" name="inactiveReason" value="Transfer"> Requested Transfer to Another Franchise</label>
            <label><input type="radio" name="inactiveReason" value="Other" onclick="document.getElementById('otherReasonInput').style.display = 'block'"> Other (Specify)</label>
        </div>

        <input type="text" id="otherReasonInput" placeholder="Specify other reason" style="display: none; margin-bottom: 20px;" />

        <div class="modal-buttons">
            <button onclick="confirmInactiveAction()" class="btn btn-primary" id="btnConfirmInactive">Confirm Inactivation</button>
            <button onclick="closeInactiveReasonModal()" class="cancel">Cancel</button>
        </div>
    </div>
</div>

<div id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

<script src="js/utils.js"></script>
<script src="js/auth.js"></script>
<script src="js/map.js"></script>
<script src="js/accounts.js"></script>
<script src="js/pnl.js"></script>
<script src="js/calculator.js"></script>
<script src="js/profile.js"></script>
<script src="js/ad_generator.js"></script>
<script src="js/metrics.js"></script>
<script src="js/employees.js"></script>
<script src="js/scheduler.js"></script>
<script src="js/payroll.js"></script>

<script src="js/main.js"></script>

</body>
</html>